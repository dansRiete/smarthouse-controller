<?xml version="1.0" encoding="UTF-8"?>
<data>
  <object-set>
    <database path="postgres">
      <view name="monthly_spending_report" query="WITH date_range AS (&#xa;    -- Get the start and end of your transaction history&#xa;    SELECT&#xa;        DATE_TRUNC(&apos;month&apos;, MIN(transaction_date)) AS start_month,&#xa;        DATE_TRUNC(&apos;month&apos;, MAX(transaction_date)) AS end_month&#xa;    FROM finance.transaction&#xa;),&#xa;     all_months AS (&#xa;         -- Generate every month in that range&#xa;         SELECT generate_series(start_month, end_month, &apos;1 month&apos;::interval)::date AS month&#xa;         FROM date_range&#xa;     ),&#xa;     all_categories AS (&#xa;         -- Get all categories that have ever had spending (or all categories in the table)&#xa;         SELECT DISTINCT id, name FROM finance.category&#xa;         WHERE name != &apos;Payment&apos; -- Usually excluded from spending averages&#xa;     ),&#xa;     monthly_spend AS (&#xa;         -- Calculate actual spending per month/category&#xa;         SELECT&#xa;             DATE_TRUNC(&apos;month&apos;, t.transaction_date)::date AS month,&#xa;             t.category_id,&#xa;             SUM(ABS(t.amount)) AS amount&#xa;         FROM finance.transaction t&#xa;         WHERE t.amount &lt; 0 AND t.ignore = FALSE&#xa;         GROUP BY 1, 2&#xa;     )&#xa;-- Combine everything to ensure $0 months are included&#xa;SELECT&#xa;    c.name AS category_name,&#xa;    ROUND(AVG(COALESCE(ms.amount, 0)), 2) AS true_monthly_average,&#xa;    SUM(CASE WHEN ms.amount &gt; 0 THEN 1 ELSE 0 END) AS months_with_spending,&#xa;    COUNT(am.month) AS total_months_in_period,&#xa;    ROUND(SUM(COALESCE(ms.amount, 0)), 2) AS total_spent_all_time&#xa;FROM&#xa;    all_months am&#xa;        CROSS JOIN&#xa;    all_categories c&#xa;        LEFT JOIN&#xa;    monthly_spend ms ON am.month = ms.month AND c.id = ms.category_id&#xa;GROUP BY&#xa;    c.name&#xa;HAVING&#xa;    SUM(COALESCE(ms.amount, 0)) &gt; 0 -- Hide categories that never had any spending&#xa;ORDER BY&#xa;    true_monthly_average DESC;"/>
      <view name="spending_report" query="SELECT&#xa;    TO_CHAR(t.transaction_date, &apos;YYYY-MM&apos;) AS month,&#xa;    subcategory,&#xa;    SUM(ABS(t.amount)) AS total_spent&#xa;FROM&#xa;    finance.transaction t&#xa;WHERE&#xa;    t.amount &lt; 0&#xa;GROUP BY&#xa;    TO_CHAR(t.transaction_date, &apos;YYYY-MM&apos;)&#xa;       , subcategory&#xa;ORDER BY&#xa;    subcategory,&#xa;    month DESC;"/>
      <view name="transactions" query="select t.id, t.transaction_date, t.description, t.amount, c.name, cc.last_four, c.description, t.is_pending, t.ignore&#xa;       from finance.transaction t &#xa;           join finance.credit_card cc on t.card_id = cc.id&#xa;join finance.category c on c.id = t.category_id&#xa;where t.amount &lt; 0&#xa;order by t.transaction_date desc "/>
    </database>
  </object-set>
</data>