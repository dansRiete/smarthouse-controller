# Global Agent Configuration
[agent]
  interval = "10s"                   # Default data collection interval
  round_interval = true              # Round collection interval to the nearest second
  metric_buffer_limit = 10000        # Metrics buffer to avoid data loss
  flush_interval = "10s"             # Time interval to flush data to outputs
  debug = true                       # Debug mode (verbose logging for troubleshooting)
  quiet = false                      # Disable quiet mode
  logfile = ""                       # Console logs only, no logfile output

[[inputs.mqtt_consumer]]
  servers = ["tcp://smarthouse-mqtt-broker:1883"]  # Use the MQTT broker service name from Compose
  topics = ["mqtt.smarthouse"]                     # Topic(s) to subscribe to
  qos = 1                                          # QoS level (0 = at most once)
  tag_keys = ["publisherId", "measurePlace", "inOut"]  # Use these fields as tags in measurements

  # Enable persistent MQTT sessions
  client_id = "telegraf-client-1"                  # Client identifier for session persistence
  persistent_session = true                        # Keep session across connections

  # Data format configuration
  data_format = "json"
  name_override = "935_CORKWOOD_ST"       # Custom measurement name
  json_string_fields = ["publisherId", "measurePlace", "inOut"]  # Treat these fields as strings
  [[processors.rename]]
      [[processors.rename.replace]]
        field = "air_temp_celsius"
        dest = "temp"

      [[processors.rename.replace]]
        field = "air_temp_rh"
        dest = "rh"

      [[processors.rename.replace]]
        field = "air_temp_ah"
        dest = "ah"

      [[processors.rename.replace]]
        field = "air_pressure_mmHg"
        dest = "pressure"

# Output Plugin Configuration: InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]                  # Use the InfluxDB service name from Compose
  token = "smarthouse_token"  # Authentication token (replace with the actual token from InfluxDB setup)
  organization = "Home"                            # InfluxDB organization name
  bucket = "935-CORKWOOD"                          # InfluxDB bucket name

# Optional Debugging Output: Console Logging
[[outputs.file]]
  files = ["stdout"]                               # Output to the console for debugging
  influx_sort_fields = true                        # Sort fields alphabetically for readability
  data_format = "influx"                           # Print in Influx line protocol format
